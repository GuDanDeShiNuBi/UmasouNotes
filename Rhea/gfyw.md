
###### 光伏电站运维系统

* [视频地址] https://space.bilibili.com/10889504

* 修改1+x光伏电站软件，增加一个竞赛版本，供学校考试时使用
  * 新建数据库
  * 学生操作完成后原本会生成一张excel表记录分数，竞赛版则修改为学生操作完成后，将考试分数上传至数据库进行保存
  * 目前还未获得源工程文件
  
* 20230202 安装破解软件，万维引擎，查看工程
* 熟悉万维引擎
* 熟悉光伏电站运维系统工程及源码
* 修改软件

20230222 
* 缺少万维引擎说明文档，和有关数据表格中各参数的定义规范 
* 工程存在问题，不确定是否是正确版本
* 引擎局限性大，开发所有功能均基于万维引擎底层程序，如果某功能在底层程序中不存在还需要万维嵌入或自行重新编写
* 开发不需考虑代码层面，是基于excel表进行， 表格格式已固定，参数输入的规范需在万维引擎说明文档进行查找。
* 出现错误无法定位
* 表格写程序，不如自研引擎，误导新手，了解不到程序原理。总结：懂程序的不需要，不懂的被误导，应该叫万维表格

20230227
* 只有考试模式有得分导出，需要保存至数据库
* 软件解密窗口需要插入加密狗
* 远程查看工程报错问题
* 提交分数后将分数赋值给场景一物体或者text,然后读取
* 按照姓名、学号保存

20230310
* 新增软件登录功能
* 按照登录账号保存分数
* 新增教师账号，分数导出功能
  * 新建分数查询界面
  * 汇总分数并绘制excel表导出
* 同账号下分数提交后，如已经存在，则进行覆盖 

20230321
* 增加教师账号‘快速更改学生成绩’小工具
  * 创建学生成绩界面
  * 可随意更改学生各题成绩
  * 按照某个教师账号操作

软件之前名称：光伏电站虚拟仿真实训系统 Vesta-VR20 (光伏电站虚拟仿真实训系统)


#### 软件问题记录

- 软件分辨率：1920x1080 ,如果使用其他分辨率，会出现选不中按钮的情况
- 20230625
  - 能源场站软件问题巡检模块故障位置不对，行列不对
  - 教学模式中，巡检中故障位置与考试模式中故障位置相同，为防止直接抄袭此数据，因此教师模式中设定的巡检中故障位置并不正确，仅是参考作用
- 2023.7.3
  - 针对学校提交成绩后，成绩未更新问题
    - 版本号：V1.0.2
    - 修改了考试模式下的excel表，各流程步骤得分进行实时读取保存，最后提交成绩时进行上传
- 20230724
  - 考试模式中，热成像仪 成像不显示问题修改
    - 发布V1.0.3版本
    - 修改了考试模式excel，将热力图路径改为：Canvas.教学模式菜单.各种表.组件热力图。并将成像的UI复制到canvas.教学模式.各种表中，本来处于canvas.教学模式.案例21菜单中，属于原本软件的bug

-20230802
- [x] 在万维源工程上，新创建一个版本，增加账号密码登录。增加账号创建工具。
  - 账号的创建包含：删除账号 编辑账号、添加账号，账号查询，用户信息展示
  - [x] 20230829 增加了批量添加删除账号、批量导出账号
- [x] 教学模式中，点击光伏安全教程无反应
  - 发布V1.0.3版本
  - 原程序采用Resource 加载，编辑器模式可正常打开打包后出现问题。现修改为StreamingAssets加载
- 20230803
  - [x] V1.0.3版本软件出现了切换到小窗口时，软件左上角窗口名称出现“改分工具”字样，为unity引擎打包发布配置问题
    - 仅V1.0.3版本存在这种状况，该版本目前未发送到学校使用，且软件为全屏使用
  - [x] 组串式巡检考试热成像仪程序也不用显示  
 20230814
  - 考核模式步骤12，有时做完出现不是100,只得50分的情况
    - 软件设计问题：第一步骤完成后如果在5s内完成了步骤2，则会出现50分的情况。步骤1的得分逻辑与步骤2的逻辑冲突
      - 应对将‘步骤1得分’这个逻辑放到5s延迟前，并减少延迟时间。或者直接将时间设置成2s
20230828
- [x] 分数界面，表格自适应问题，content未设置正确

20231013
- [x] 建账号时需注意，不同教师账号可能学生账号同名，导致分数互相覆盖
  - 虽然在建账号时查询了teaid，不同教师下学生账号名可以重，但保存分数是仅按照账号保存的，没加teaid条件。解决方案：设置不同教师下学生账号也不能重名，或保存分数是加teaid条件

20231120
- [x] 软件登录时，设置账号位数。限制空格输入，只允许字母加数字
- [x] 软件本地文件保存，文件需加密隐藏。从本地文件读取分数，进行上传。
- tips: 当次考核中，重复提交后成绩会在表格自动更新。如果重新登录软件，进行考核，会将之前的文件删除，重新生成成绩文件
- 万维表格会在等待时间后，停止程序的协程或进程
- [x] 设置了两次成绩提交。并且在数据库上传数据时，进行判定重连
- [x] 原来成绩提交逻辑为：万维表格中点击提交按钮后激活场景物体，调用脚本onEnable，onenable调用成绩提交 。现改为：代码监听按钮，调用提交成绩.原因：场景物体会在场景退出时，重新激活一次，调用了onenable
  

20240322
- [ ] 提交成绩，依然出现未提交成功问题
  - V1.0.5版本是在源程序保存成绩表到本地后在进行读取本地文件，在进行上传成绩。V1.0.6改为：直接在源码action_generate_report脚本中,GenerateReport时进行数据库数据保存，即成绩提交。 
- [ ] V1.0.6打包发布,该版本取消生成本地文件，不含隐藏文件

20240326
- [ ] 增加登录状态判定，防止一个账号同时登录（新型运维和原版光伏运维）
  - 可在后端设置代码，增加账号登录状态， 已登录软件 基础功能

20240426
- [ ] 用户的分数记录，在首次保存分数后才会产生，需在程序中确认下，可以修改为登录后就有分数记录

20240628
 - 能源场站要加瑞亚的log 还有型号:RHNPS-NY 仿真规划加型号：RHNPS-GH

20240903
 - 修改原版运维软件 的账号管理工具，增加滑动条，按日期排列

20240906
- 光伏电站运维实训系统（1+x）发布linux,测试通过

20240909
- 电脑杀毒软件、管理员身份运行，都有可能影响成绩本地保存
- 发现：竞赛时成绩未提交成功的，数据库成绩记录都没有添加。说明当时与数据库的交互逻辑根本没有执行，有可能是数据库连接断开，或者杀毒软件阻断，或者源程序阻断。
  - 1、杀毒软件运行前将杀毒软件关闭并以管理员身份运行；
    - [ ] 电脑安装杀毒软件测试
  - 2、源程序阻断
    - [x] 将与数据库的交互逻辑直接写进源码中。
  - 3、数据库连接
    - [x] 制定解决方案，公司内部测试，共25台
      - 程序中加入了提交后的检查，检查了1次，没有做时间间隔
      - 第一遍测试：有2台配置低的电脑未提交成功，提交时有有卡顿现象
      - 第二遍提交：两台未提交成功

20240913
- 1、加入了3次提交后检查，每2秒检查一次
- 2、加入了多线程，在主程序完成后，多线程再次上传
- 3、增加了控制台应用程序，程序结束前启动该程序，读取表格文件数据上传
  - 控制台应用程序，运行完会自动关闭，可以多次运行



20241018
- 软件优化：
- 1、unity与mysql的连接，用完即关闭，使用时再打开（因为与数据库的交互只有在登录和提交成绩会用到，防止长时间不交互断开）
- 2、在软件关闭前，关闭与数据库的连接
- 3、正确关闭线程
- 4、为什么还在unity中使用线程上传成绩，为了防止外部程序打不开

- 2024国赛专用版本开发：
- 1、在V1.0.6工程上修改
- 2、将文件设置为保护状态，输入密码才可编辑：在源程序NewExcel  ExcelWriter（）方法添加：sheet.ProtectSheet("rhea24gs");开启工作簿保护。
- 3、提交成绩后直接打开成绩表 
- 4、关闭成绩上传云端功能

20241127
- [ ] 光伏运维原版本软件 添加退出登录windows程序。

20241224
- 发现问题：当处于主界面（主场景）关闭软件时，未调用外部程序GFVR进行提交成绩，仅在教学模式关闭软件时会调用。因为教学模式的场景与主界面不是用一个场景。
- 解决：在主场景增加Applicationquit，进行外部程序调用。
- 发现问题：当主动修改生成的成绩表的分数时，再次提交会无法提交。因为成绩表的数据格式必须为文本类型，修改分数后变成了数字类型，无法读取


1 20 35 50 75 100
2 25 50 75 100
3 25 50 75 100
4 10 20 30  - 80 90 100
5 20 40 60 80 100
6 80 90 100
7 25 50 75 100
8 30 70 100
9 20 40 60 80 100 
10 80 100
11 20 40 60 80 
12  50 100
13 20 60 80 100